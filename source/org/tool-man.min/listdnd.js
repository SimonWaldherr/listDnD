var ToolMan={events:function(){if(!ToolMan._eventsFactory){throw"ToolMan Events module isn't loaded"}return ToolMan._eventsFactory},css:function(){if(!ToolMan._cssFactory){throw"ToolMan CSS module isn't loaded"}return ToolMan._cssFactory},coordinates:function(){if(!ToolMan._coordinatesFactory){throw"ToolMan Coordinates module isn't loaded"}return ToolMan._coordinatesFactory},drag:function(){if(!ToolMan._dragFactory){throw"ToolMan Drag module isn't loaded"}return ToolMan._dragFactory},dragsort:function(){if(!ToolMan._dragsortFactory){throw"ToolMan DragSort module isn't loaded"}return ToolMan._dragsortFactory},helpers:function(){return ToolMan._helpers},cookies:function(){if(!ToolMan._cookieOven){throw"ToolMan Cookie module isn't loaded"}return ToolMan._cookieOven},junkdrawer:function(){return ToolMan._junkdrawer}};ToolMan._helpers={map:function(d,b){for(var a=0,c=d.length;a<c;a++){b(d[a])}},nextItem:function(b,c){if(b==null){return}var a=b.nextSibling;while(a!=null){if(a.nodeName==c){return a}a=a.nextSibling}return null},previousItem:function(b,c){var a=b.previousSibling;while(a!=null){if(a.nodeName==c){return a}a=a.previousSibling}return null},moveBefore:function(b,a){var c=b.parentNode;c.removeChild(b);c.insertBefore(b,a)},moveAfter:function(b,a){var c=b.parentNode;c.removeChild(b);c.insertBefore(b,a?a.nextSibling:null)}};ToolMan._junkdrawer={serializeList:function(d){var a=d.getElementsByTagName("li");var f=new Array();for(var b=0,e=a.length;b<e;b++){var c=a[b];f.push(ToolMan.junkdrawer()._identifier(c))}return f.join("|")},inspectListOrder:function(a){alert(ToolMan.junkdrawer().serializeList(document.getElementById(a)))},restoreListOrder:function(h){var f=document.getElementById(h);if(f==null){return}var b=ToolMan.cookies().get("list-"+h);if(!b){return}var d=b.split("|");var g=ToolMan.junkdrawer()._itemsByID(f);for(var e=0,c=d.length;e<c;e++){var a=d[e];if(a in g){var j=g[a];f.removeChild(j);f.insertBefore(j,null)}}},_identifier:function(c){var a=ToolMan.junkdrawer().trim;var b;b=a(c.getAttribute("id"));if(b!=null&&b.length>0){return b}b=a(c.getAttribute("itemID"));if(b!=null&&b.length>0){return b}return a(c.innerHTML)},_itemsByID:function(d){var f=new Array();var a=d.getElementsByTagName("li");for(var b=0,e=a.length;b<e;b++){var c=a[b];f[ToolMan.junkdrawer()._identifier(c)]=c}return f},trim:function(a){if(a==null){return null}return a.replace(/^(\s+)?(.*\S)(\s+)?$/,"$2")}};ToolMan._eventsFactory={fix:function(a){if(!a){a=window.event}if(a.target){if(a.target.nodeType==3){a.target=a.target.parentNode}}else{if(a.srcElement){a.target=a.srcElement}}return a},register:function(b,c,d){if(b.addEventListener){b.addEventListener(c,d,false)}else{if(b.attachEvent){if(!b._listeners){b._listeners=new Array()}if(!b._listeners[c]){b._listeners[c]=new Array()}var a=function(){d.apply(b,new Array())};b._listeners[c][d]=a;b.attachEvent("on"+c,a)}}},unregister:function(a,b,c){if(a.removeEventListener){a.removeEventListener(b,c,false)}else{if(a.detachEvent){if(a._listeners&&a._listeners[b]&&a._listeners[b][c]){a.detachEvent("on"+b,a._listeners[b][c])}}}}};ToolMan._cssFactory={readStyle:function(a,c){if(a.style[c]){return a.style[c]}else{if(a.currentStyle){return a.currentStyle[c]}else{if(document.defaultView&&document.defaultView.getComputedStyle){var b=document.defaultView.getComputedStyle(a,null);return b.getPropertyValue(c)}else{return null}}}}};ToolMan._coordinatesFactory={create:function(a,b){return new _ToolManCoordinate(this,a,b)},origin:function(){return this.create(0,0)},topLeftPosition:function(a){var c=parseInt(ToolMan.css().readStyle(a,"left"));var c=isNaN(c)?0:c;var b=parseInt(ToolMan.css().readStyle(a,"top"));var b=isNaN(b)?0:b;return this.create(c,b)},bottomRightPosition:function(a){return this.topLeftPosition(a).plus(this._size(a))},topLeftOffset:function(a){var c=this._offset(a);var b=a.offsetParent;while(b){c=c.plus(this._offset(b));b=b.offsetParent}return c},bottomRightOffset:function(a){return this.topLeftOffset(a).plus(this.create(a.offsetWidth,a.offsetHeight))},scrollOffset:function(){if(window.pageXOffset){return this.create(window.pageXOffset,window.pageYOffset)}else{if(document.documentElement){return this.create(document.body.scrollLeft+document.documentElement.scrollLeft,document.body.scrollTop+document.documentElement.scrollTop)}else{if(document.body.scrollLeft>=0){return this.create(document.body.scrollLeft,document.body.scrollTop)}else{return this.create(0,0)}}}},clientSize:function(){if(window.innerHeight>=0){return this.create(window.innerWidth,window.innerHeight)}else{if(document.documentElement){return this.create(document.documentElement.clientWidth,document.documentElement.clientHeight)}else{if(document.body.clientHeight>=0){return this.create(document.body.clientWidth,document.body.clientHeight)}else{return this.create(0,0)}}}},mousePosition:function(a){a=ToolMan.events().fix(a);return this.create(a.clientX,a.clientY)},mouseOffset:function(a){a=ToolMan.events().fix(a);if(a.pageX>=0||a.pageX<0){return this.create(a.pageX,a.pageY)}else{if(a.clientX>=0||a.clientX<0){return this.mousePosition(a).plus(this.scrollOffset())}}},_size:function(a){return this.create(a.offsetWidth,a.offsetHeight)},_offset:function(a){return this.create(a.offsetLeft,a.offsetTop)}};function _ToolManCoordinate(b,a,c){this.factory=b;this.x=isNaN(a)?0:a;this.y=isNaN(c)?0:c}_ToolManCoordinate.prototype={toString:function(){return"("+this.x+","+this.y+")"},plus:function(a){return this.factory.create(this.x+a.x,this.y+a.y)},minus:function(a){return this.factory.create(this.x-a.x,this.y-a.y)},min:function(a){return this.factory.create(Math.min(this.x,a.x),Math.min(this.y,a.y))},max:function(a){return this.factory.create(Math.max(this.x,a.x),Math.max(this.y,a.y))},constrainTo:function(d,b){var c=d.min(b);var a=d.max(b);return this.max(c).min(a)},distance:function(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))},reposition:function(a){a.style.top=this.y+"px";a.style.left=this.x+"px"}};ToolMan._dragFactory={createSimpleGroup:function(a,b){b=b?b:a;var c=this.createGroup(a);c.setHandle(b);c.transparentDrag();c.onTopWhileDragging();return c},createGroup:function(b){var c=new _ToolManDragGroup(this,b);var a=ToolMan.css().readStyle(b,"position");if(a=="static"){b.style.position="relative"}else{if(a=="absolute"){ToolMan.coordinates().topLeftOffset(b).reposition(b)}}c.register("draginit",this._showDragEventStatus);c.register("dragmove",this._showDragEventStatus);c.register("dragend",this._showDragEventStatus);return c},_showDragEventStatus:function(a){window.status=a.toString()},constraints:function(){return this._constraintFactory},_createEvent:function(a,b,c){return new _ToolManDragEvent(a,b,c)}};function _ToolManDragGroup(a,b){this.factory=a;this.element=b;this._handle=null;this._thresholdDistance=0;this._transforms=new Array();this._listeners=new Array();this._listeners.draginit=new Array();this._listeners.dragstart=new Array();this._listeners.dragmove=new Array();this._listeners.dragend=new Array()}_ToolManDragGroup.prototype={setHandle:function(b){var a=ToolMan.events();b.toolManDragGroup=this;a.register(b,"mousedown",this._dragInit);b.onmousedown=function(){return false};if(this.element!=b){a.unregister(this.element,"mousedown",this._dragInit)}},register:function(a,b){this._listeners[a].push(b)},addTransform:function(a){this._transforms.push(a)},verticalOnly:function(){this.addTransform(this.factory.constraints().vertical())},horizontalOnly:function(){this.addTransform(this.factory.constraints().horizontal())},setThreshold:function(a){this._thresholdDistance=a},transparentDrag:function(a){var a=typeof(a)!="undefined"?a:0.75;var b=ToolMan.css().readStyle(this.element,"opacity");this.register("dragstart",function(d){var c=d.group.element;c.style.opacity=a;c.style.filter="alpha(opacity="+(a*100)+")"});this.register("dragend",function(d){var c=d.group.element;c.style.opacity=b;c.style.filter="alpha(opacity=100)"})},onTopWhileDragging:function(b){var b=typeof(b)!="undefined"?b:100000;var a=ToolMan.css().readStyle(this.element,"z-index");this.register("dragstart",function(c){c.group.element.style.zIndex=b});this.register("dragend",function(c){c.group.element.style.zIndex=a})},_dragInit:function(a){a=ToolMan.events().fix(a);var c=document.toolManDragGroup=this.toolManDragGroup;var b=c.factory._createEvent("draginit",a,c);c._isThresholdExceeded=false;c._initialMouseOffset=b.mouseOffset;c._grabOffset=b.mouseOffset.minus(b.topLeftOffset);ToolMan.events().register(document,"mousemove",c._drag);document.onmousemove=function(){return false};ToolMan.events().register(document,"mouseup",c._dragEnd);c._notifyListeners(b)},_drag:function(b){b=ToolMan.events().fix(b);var j=ToolMan.coordinates();var k=this.toolManDragGroup;if(!k){return}var h=k.factory._createEvent("dragmove",b,k);var g=h.mouseOffset.minus(k._grabOffset);if(!k._isThresholdExceeded){var a=h.mouseOffset.distance(k._initialMouseOffset);if(a<k._thresholdDistance){return}k._isThresholdExceeded=true;k._notifyListeners(k.factory._createEvent("dragstart",b,k))}for(i in k._transforms){var d=k._transforms[i];g=d(g,h)}var f=g.minus(h.topLeftOffset);var e=h.topLeftPosition.plus(f);e.reposition(k.element);h.transformedMouseOffset=g.plus(k._grabOffset);k._notifyListeners(h);var c=g.minus(j.topLeftOffset(k.element));if(c.x!=0||c.y!=0){j.topLeftPosition(k.element).plus(c).reposition(k.element)}},_dragEnd:function(a){a=ToolMan.events().fix(a);var c=this.toolManDragGroup;var b=c.factory._createEvent("dragend",a,c);c._notifyListeners(b);this.toolManDragGroup=null;ToolMan.events().unregister(document,"mousemove",c._drag);document.onmousemove=null;ToolMan.events().unregister(document,"mouseup",c._dragEnd)},_notifyListeners:function(b){var a=this._listeners[b.type];for(i in a){a[i](b)}}};function _ToolManDragEvent(a,b,c){this.type=a;this.group=c;this.mousePosition=ToolMan.coordinates().mousePosition(b);this.mouseOffset=ToolMan.coordinates().mouseOffset(b);this.transformedMouseOffset=this.mouseOffset;this.topLeftPosition=ToolMan.coordinates().topLeftPosition(c.element);this.topLeftOffset=ToolMan.coordinates().topLeftOffset(c.element)}_ToolManDragEvent.prototype={toString:function(){return"mouse: "+this.mousePosition+this.mouseOffset+"    xmouse: "+this.transformedMouseOffset+"    left,top: "+this.topLeftPosition+this.topLeftOffset}};ToolMan._dragFactory._constraintFactory={vertical:function(){return function(c,b){var a=b.topLeftOffset.x;return c.x!=a?c.factory.create(a,c.y):c}},horizontal:function(){return function(c,a){var b=a.topLeftOffset.y;return c.y!=b?c.factory.create(c.x,b):c}}};ToolMan._dragsortFactory={makeSortable:function(a){var b=ToolMan.drag().createSimpleGroup(a);b.register("dragstart",this._onDragStart);b.register("dragmove",this._onDragMove);b.register("dragend",this._onDragEnd);return b},makeListSortable:function(d){var c=ToolMan.helpers();var e=ToolMan.coordinates();var a=d.getElementsByTagName("li");c.map(a,function(j){var k=dragsort.makeSortable(j);k.setThreshold(4);var h,g;k.addTransform(function(m,l){return m.constrainTo(h,g)});k.register("dragstart",function(){var l=d.getElementsByTagName("li");h=g=e.topLeftOffset(l[0]);for(var m=1,p=l.length;m<p;m++){var o=e.topLeftOffset(l[m]);h=h.min(o);g=g.max(o)}})});for(var b=1,f=arguments.length;b<f;b++){c.map(a,arguments[b])}},_onDragStart:function(a){},_onDragMove:function(f){var a=ToolMan.helpers();var g=ToolMan.coordinates();var k=f.group.element;var b=f.transformedMouseOffset;var j=null;var d=a.previousItem(k,k.nodeName);while(d!=null){var e=g.bottomRightOffset(d);if(b.y<=e.y&&b.x<=e.x){j=d}d=a.previousItem(d,k.nodeName)}if(j!=null){a.moveBefore(k,j);return}var c=a.nextItem(k,k.nodeName);while(c!=null){var h=g.topLeftOffset(c);if(h.y<=b.y&&h.x<=b.x){j=c}c=a.nextItem(c,k.nodeName)}if(j!=null){a.moveBefore(k,a.nextItem(j,k.nodeName));return}},_onDragEnd:function(a){ToolMan.coordinates().create(0,0).reposition(a.group.element)}};